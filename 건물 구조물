/*
ì»¨íŠ¸ë¡¤ëŸ¬ ì—…ê·¸ë ˆì´ë“œë¥¼ í†µí•´ ë²½, ì„±ë²½ ë° í™•ì¥ê³¼ ê°™ì€ ì¼ë¶€ ìƒˆ êµ¬ì¡°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ë‹¤ìŒì„¹ì…˜ì—ì„œ ë²½ê³¼ ì„±ë²½ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ì´ì œ í™•ì¥ì— ëŒ€í•´ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
ë” í° í¬ë¦½ì„ ë§Œë“¤ë ¤ë©´ í™•ì¥ì´ í•„ìš”í•©ë‹ˆë‹¤. í•œ ì¢…ë¥˜ì˜ ì‹ ì²´ ë¶€ìœ„ë§Œ ìˆëŠ” í¬ë¦¬í”„ëŠ” ì˜ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 
ì—¬ëŸ¬ ê°œì˜ WORKë¥¼ ì œê³µí•˜ë©´ ê·¸ì— ë¹„ë¡€í•˜ì—¬ ë” ë¹¨ë¦¬ ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ, ê·¸ëŸ¬í•œ ìƒˆë¼ëŠ” ë¹„ìš©ì´ ë§ì´ ë“¤ ê²ƒì´ê³  ì™¸ë¡œìš´ ìƒˆë¼ëŠ” 300ê°œì˜ ì—ë„ˆì§€ ìœ ë‹›ë§Œ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
300ê°œ ì´ìƒì˜ ì—ë„ˆì§€ ë‹¨ìœ„ê°€ ë“¤ì–´ê°€ëŠ” í¬ë¦½ì„ ë§Œë“¤ë ¤ë©´ ì‚°ë€ì„ í™•ì¥í•´ì•¼ í•©ë‹ˆë‹¤.
*/

/*
ë‘ ë²ˆì§¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆë²¨ì—ëŠ” ë¹Œë“œí•  ìˆ˜ ìˆëŠ” 5ê°œì˜ í™•ì¥ì´ ìˆìŠµë‹ˆë‹¤. ì´ ìˆ«ìëŠ” ê° ìƒˆ ë ˆë²¨ì— ë”°ë¼ ì¦ê°€í•©ë‹ˆë‹¤.
ë£¸ì˜ ì„ì˜ ìœ„ì¹˜ì— í™•ì¥ìë¥¼ ë°°ì¹˜í•  ìˆ˜ ìˆìœ¼ë©°, ê±°ë¦¬ì— ìƒê´€ì—†ì´ ì‚°ë€ì´ í™•ì¥ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì—¬ê¸°ì—ì„œëŠ” ê·€í•˜ì˜ í¸ì˜ë¥¼ ìœ„í•´ í•´ë‹¹ ê±´ì„¤ í˜„ì¥ì„ ì´ë¯¸ ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤. (ë ˆë²¨ì´ ë˜ë©´ ë§ˆìš°ìŠ¤ë¡œ ê±´ì„¤í˜„ì¥ ìƒì„±ê°€ëŠ¥)
*/

/*
ê±´ì¶•ë¬¼ì„ ë§Œë“œëŠ” ê²ƒì´ ëª©ì ì¸ ìƒˆë¡œìš´ í¬ë¦½ì„ ë§Œë“¤ì–´ë³´ì£ . ì´ í”„ë¡œì„¸ìŠ¤ëŠ” ì´ì „ì„¹ì…˜ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. 
ê·¸ëŸ¬ë‚˜ ì´ë²ˆì—ëŠ” ì„¸ ë²ˆì§¸ ì¸ìˆ˜ì— ì „ë‹¬í•˜ì—¬ Culf.spawnCreep ë°©ë²•ì—ì„œ ìƒˆë¡œìš´ í¬ë¦½ì— ëŒ€í•œ ë©”ëª¨ë¦¬ë¥¼ ì„¤ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.
Builder1 ë° {role:'builder'}ì´ë¼ëŠ” ë³¸ë¬¸ì„ ë©”ëª¨ë¦¬ë¡œ ì‚¬ìš©í•˜ì—¬ í¬ë¦½ì„ ìƒì„±í•©ë‹ˆë‹¤.
*/

(console)
Game.spawns['Spawn1'].spawnCreep( [WORK, CARRY, MOVE], 'Builder1',
    { memory: { role: 'builder' } } );

/*
ë¹Œë”ì— ëŒ€í•œ í–‰ë™ì„ ì •ì˜í•˜ê¸° ì „ê¹Œì§€ëŠ” ìš°ë¦¬ì˜ ìƒˆë¡œìš´ í¬ë¦½ì€ ì›€ì§ì´ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.
*/

/*
ì´ì „ê³¼ ê°™ì´ ì´ ì—­í• ì„ ë³„ë„ì˜ ëª¨ë“ˆ ì—­í• ë¡œ ì˜®ê²¨ë³´ê² ìŠµë‹ˆë‹¤. ê±´ì¶•ê°€ì…ë‹ˆë‹¤. 
Room.find(FIND_CRUMNATION_SITE)ì—ì„œ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê±´ì„¤ í˜„ì¥ì— Creep.build ë°©ë²•ì„ ì ìš©í•˜ì—¬ ê±´ë¬¼ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. 
ê·¸ êµ¬ì¡°ëŠ” ë‹¹ì‹ ì˜ í¬ë¦½ì´ ìŠ¤ìŠ¤ë¡œ ìˆ˜í™•í•  ìˆ˜ ìˆëŠ” ì—ë„ˆì§€ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.
í¬ë¦½ì´ ì•ë’¤ë¡œ ë„ˆë¬´ ìì£¼ ë‹¬ë¦¬ì§€ë§Œ í™”ë¬¼ì„ ê³ ê°ˆì‹œí‚¤ëŠ” ê²ƒì„ í”¼í•˜ê¸° ìœ„í•´, 
ìƒˆë¡œìš´ ë¶€ìš¸ ë³€ìˆ˜ creep.memory.building ì„ ë§Œë“¤ì–´ í¬ë¦½ì—ê²Œ ì‘ì—…ì„ ì „í™˜í•  ë•Œë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤. 
ë˜í•œ moveTo ë©”ì„œë“œì— ìƒˆë¡œìš´ creep.say í˜¸ì¶œ ë° ì‹œê°í™” PathStyle ì˜µì…˜ì„ ì¶”ê°€í•˜ì—¬ í¬ë¦½ì˜ ì˜ë„ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.
ëª¨ë“ˆ ì—­í• ì„ ìƒì„±í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ í¬ë¦½ì„ ìœ„í•œ í–‰ë™ ë…¼ë¦¬ë¥¼ ê°€ì§„ ê±´ì¶•ê°€ì…ë‹ˆë‹¤.

https://docs.screeps.com/api/#RoomObject.room
https://docs.screeps.com/api/#Room.find
https://docs.screeps.com/api/#Creep.build
https://docs.screeps.com/api/#Creep.say
*/

(role.builder)
var roleBuilder = {

    /** @param {Creep} creep **/
    run: function(creep) {

	    if(creep.memory.building && creep.store[RESOURCE_ENERGY] == 0) {
            creep.memory.building = false;
            creep.say('ğŸ”„ harvest');
	    }
	    if(!creep.memory.building && creep.store.getFreeCapacity() == 0) {
	        creep.memory.building = true;
	        creep.say('ğŸš§ build');
	    }

	    if(creep.memory.building) {
	        var targets = creep.room.find(FIND_CONSTRUCTION_SITES);
            if(targets.length) {
                if(creep.build(targets[0]) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
	    }
	    else {
	        var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
	    }
	}
};

module.exports = roleBuilder;

/*
ì£¼ ëª¨ë“ˆì—ì„œ ìƒˆ ì—­í• ì˜ í˜¸ì¶œì„ ë§Œë“¤ê³  ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
ëª¨ë“ˆ ì—­í• ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.ìƒˆë¡œìš´ í¬ë¦½ì— ë¹Œë”, í™•ì¥ 5ê°œë¥¼ ëª¨ë‘ ì§€ì–´ì•¼ í•©ë‹ˆë‹¤.
*/

(main)
var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}

/*
í™•ì¥ì„ ìœ ì§€í•˜ë ¤ë©´ ìˆ˜í™•ìì—ê²Œ ì‚°ë€ì„ ìœ„í•œ ì—ë„ˆì§€ë¿ë§Œ ì•„ë‹ˆë¼ í™•ì¥ìì—ë„ ì—ë„ˆì§€ë¥¼ ì „ë‹¬í•˜ë„ë¡ ê°€ë¥´ì¹  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. 
ì´ë ‡ê²Œ í•˜ë ¤ë©´ Game.structures ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ Room.find(FIND_STRORESS)ì˜ ë„ì›€ì„ ë°›ì•„ ë£¸ ë‚´ì—ì„œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ë‘ ê²½ìš° ëª¨ë‘ ìƒíƒœ structure.structureType == STRUCTURE_EXTENSION(ë˜ëŠ” êµ¬ì¡°ë¬¼ì˜ structure instanceof StructureExtension) 
ë° ì´ì „ê³¼ ê°™ì´ ì—ë„ˆì§€ ë¶€í•˜ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
ëª¨ë“ˆ role.harvesterì˜ ë…¼ë¦¬ë¥¼ ì„¸ë¶„í™”í•©ë‹ˆë‹¤.

https://docs.screeps.com/api/#Game.structures
https://docs.screeps.com/api/#Room.find
https://docs.screeps.com/api/#StructureExtension
*/

(role.harvester)
var roleHarvester = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
        }
        else {
            var targets = creep.room.find(FIND_STRUCTURES, {
                    filter: (structure) => {
                        return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&
                            structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;
                    }
            });
            if(targets.length > 0) {
                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
        }
	}
};

module.exports = roleHarvester;

/*
ë°©ì˜ ì´ ì—ë„ˆì§€ ì–‘ì„ ì•Œê¸° ìœ„í•´ Room.energyAvailable ì†ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
í™•ì¥ìë¥¼ ì±„ìš°ëŠ” ë™ì•ˆ ì´ ì†ì„±ì˜ ì¶œë ¥ì„ ì¶”ì í•˜ê¸° ìœ„í•´ ì½˜ì†”ì— ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.
ëª¨ë“  5ê°œì˜ ì—°ì¥ì„ ê³¼ ì‚°ë€ì„ ì—ë„ˆì§€ë¡œ ì±„ì›ë‹ˆë‹¤.

https://docs.screeps.com/api/#Room.energyAvailable
*/

(main)
var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.rooms) {
        console.log('Room "'+name+'" has '+Game.rooms[name].energyAvailable+' energy');
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}

/*
ëª¨ë“  êµ¬ì¡°ë¬¼ì´ ì—ë„ˆì§€ë¡œ ê°€ë“ ì°¨ë©´. ì´ì œ í¬ë¦½ì„ í¬ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*/

(console)
Game.spawns['Spawn1'].spawnCreep( [WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE],
    'HarvesterBig',
    { memory: { role: 'harvester' } } );
